# 会社HP自動検索・貼り付けツール 実装計画チェックリスト

**プロジェクト開始日**: 2024年12月19日  
**目標**: 90%以上の精度で公式HPトップページを検出する自動化ツールの構築

---

## 🔧 開発環境・基盤準備

### プロジェクト初期設定
- [x] プロジェクトディレクトリ構造の作成
- [x] Python仮想環境のセットアップ（Python 3.8以降）
- [x] requirements.txtの作成と必要ライブラリのリストアップ
- [x] .gitignoreファイルの作成（APIキーや設定ファイルの除外）
- [x] README.mdの作成（基本的な使用方法）

### API認証準備
- [ ] Brave Search API Proプランの契約とAPIキー取得
- [ ] Google Cloud Projectの作成
- [ ] Google Sheets APIとGoogle Drive APIの有効化
- [ ] サービスアカウントの作成とJSONキーのダウンロード
- [ ] 環境変数または設定ファイルでのAPIキー管理設定

---

## 📁 プロジェクト構造設計

### モジュール設計（疎結合化）
- [x] `config/` - 設定ファイル管理ディレクトリ
- [x] `src/data_loader.py` - Google Sheets読み込みモジュール
- [x] `src/search_agent.py` - Brave Search API連携モジュール
- [x] `src/scorer.py` - スコアリングロジックモジュール
- [x] `src/output_writer.py` - Google Sheets書き込みモジュール
- [x] `src/logger_config.py` - ログ設定モジュール
- [x] `src/utils.py` - 共通ユーティリティモジュール
- [ ] `tests/` - テストファイル群ディレクトリ
- [ ] `logs/` - ログファイル出力先ディレクトリ

### 設定ファイル設計
- [x] `config/config.yaml` - メイン設定（APIキー、スコアリング配点等）
- [x] `config/blacklist.yaml` - ブラックリストドメイン・パス
- [x] `config/query_patterns.yaml` - 検索クエリパターン

---

## ⚡ フェーズ1: クエリテスト支援スクリプト

### データ読み込み機能
- [x] Google Sheets API認証の実装
- [x] スプレッドシート読み込み機能（企業ID、店舗名、都道府県、業種）
- [x] 読み込み範囲の設定可能化
- [x] エラーハンドリング（認証エラー、シート存在チェック等）

### 検索クエリ実行機能
- [x] Brave Search API基本接続の実装
- [x] 3つのクエリパターンの動的生成
  - [x] クエリA: `店舗名 業種 都道府県`
  - [x] クエリB: `"店舗名 都道府県 公式サイト"`
  - [x] クエリC: `"店舗名 業種 公式" site:co.jp OR site:com`
- [x] フレーズ検索（ダブルクォーテーション）の適切な処理
- [x] 検索結果上位N件の取得（デフォルト10件、設定可能）
- [x] API制限遵守（簡易的なレートリミット制御）

### 結果出力機能
- [x] 画面表示機能（企業名、クエリ、取得URL一覧）
- [x] ファイル出力機能（CSV、テキスト形式選択可能）
- [x] ユーザーによる目視評価がしやすい形式での出力

### 基本エラーハンドリング
- [x] APIリクエストエラーの捕捉
- [x] ネットワークタイムアウトの処理
- [x] 基本的なログ出力

---

## 🧪 フェーズ2: 最適クエリ戦略決定支援

### テスト結果分析支援
- [ ] フェーズ1結果の集計・分析機能
- [ ] クエリ別成功率の計算
- [ ] 推奨クエリ組み合わせの提案ロジック

---

## 🚀 フェーズ3: 本格機能開発

### 高度なデータ処理
- [ ] 未処理行の自動検出（HP URL列が空欄）
- [ ] 処理済みフラグ管理機能
- [ ] 中断・再開機能の実装

### 最適化された検索機能
- [ ] フェーズ2で決定された最適クエリ戦略の実装
- [ ] 段階的クエリ実行ロジック（条件分岐による効率化）
- [ ] 非同期処理（asyncio + aiohttp）の実装
- [ ] セマフォによる同時実行数制御（最大20件）
- [ ] 指数バックオフリトライ機能

### 公式HP判定ロジック
- [ ] URLブラックリストフィルタリング
- [ ] パスペナルティの実装
- [ ] トップページ判定ロジック（URLパス分析）
- [ ] HTTPリダイレクト追跡機能
- [ ] HTMLコンテンツ解析（BeautifulSoup）
  - [ ] `<title>`タグ解析
  - [ ] `<meta description>`解析
  - [ ] 「公式」「オフィシャル」キーワード検出

### スコアリングアルゴリズム
- [ ] 文字列類似度計算（rapidfuzz）の実装
- [ ] ドメイン名と店舗名の一致度評価
- [ ] 各評価項目のスコア計算
  - [ ] トップページ判定ボーナス（+5点）
  - [ ] ドメイン完全一致（+5点）
  - [ ] ドメイン類似度80%以上（+3点）
  - [ ] TLD評価（.co.jp: +3点、.com/.net: +1点）
  - [ ] 公式キーワードボーナス（+2点）
  - [ ] 検索上位ボーナス（1-3位: +3点）
- [ ] 減点項目の実装
  - [ ] .jp単独ドメイン（-2点）
  - [ ] 求人・ブログ関連パス（-2点）
- [ ] 信頼度判定（9点以上: 自動採用、6-8点: 要確認、5点以下: 手動確認）

### 結果出力機能
- [ ] Google Sheetsへの自動書き込み
  - [ ] 検出HP URL
  - [ ] 信頼度スコア
  - [ ] 判定結果
  - [ ] 使用クエリ
- [ ] バッチ更新による効率化
- [ ] 書き込みエラーハンドリング

### 包括的ログ機能
- [ ] 構造化ログの実装（JSON形式推奨）
- [ ] ログレベル設定（DEBUG, INFO, WARNING, ERROR, CRITICAL）
- [ ] 日付ローテーション機能
- [ ] 処理詳細の記録
  - [ ] 処理日時、企業ID
  - [ ] 実行クエリ、取得URL候補
  - [ ] 各種スコア、最終判定結果
  - [ ] エラー情報（スタックトレース含む）

### 設定管理
- [ ] 外部設定ファイル（YAML推奨）
- [ ] 設定値のバリデーション
- [ ] 動的設定変更への対応

---

## 🧪 テスト実装

### 単体テスト
- [ ] 各モジュールのテストケース作成
- [ ] APIレスポンスのモッキング
- [ ] エッジケースのテスト
- [ ] スコアリングロジックの精度テスト

### 結合テスト
- [ ] モジュール間連携テスト
- [ ] エラーフロー全体のテスト

### 総合テスト
- [ ] ゴールデンデータセットでの精度測定
- [ ] パフォーマンステスト（1000件/日対応）
- [ ] 90%精度目標の達成確認

---

## 🔐 セキュリティ・運用準備

### セキュリティ対策
- [ ] APIキーの安全な管理（環境変数・設定ファイル）
- [ ] ソースコードからの機密情報完全除去
- [ ] アクセス権限の適切な設定

### 運用準備
- [ ] バッチ実行スクリプトの作成
- [ ] エラー監視・通知機能
- [ ] API使用量・コスト監視
- [ ] 定期メンテナンス手順書

### ドキュメント作成
- [ ] ユーザーマニュアル
- [ ] 運用手順書
- [ ] 設定変更ガイド
- [ ] トラブルシューティングガイド

---

## 📊 パフォーマンス最適化

### 効率化
- [ ] 非同期処理の最適化
- [ ] メモリ使用量の最適化
- [ ] API呼び出し回数の最小化
- [ ] キャッシュ機能の検討

### スケーラビリティ
- [ ] 大量データ処理への対応
- [ ] 並列処理数の動的調整
- [ ] エラー耐性の向上

---

## ✅ 重複実装の防止確認
- [ ] 既存の類似機能がないことを確認
- [ ] 同名または類似名の関数・コンポーネントがないことを確認
- [ ] 共通化可能な処理の特定と統合

## 🎯 最終確認
- [ ] 全ての要件が実装されていることを確認
- [ ] 性能要件（1000件/日、90%精度）の達成確認
- [ ] コード品質・保守性の確認
- [ ] セキュリティ要件の遵守確認

---

## 📝 進捗メモ

### 完了済みタスク
<!-- ここに完了したタスクの詳細や気づきをメモ -->

### 課題・注意点
<!-- 実装中に発見した課題や注意すべき点をメモ -->

### 次のステップ
<!-- 次に取り組むべき優先タスクをメモ -->

---

**最終更新**: 2024年12月19日  
**進捗率**: 22.5% (27/120 タスク完了) 